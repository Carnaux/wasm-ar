var WasmAR=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}e.exports=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}},function(e,t,n){"use strict";n.r(t);var i=n(0),o=n.n(i),r=n(1),a=n.n(r),d=function(){function e(t){o()(this,e);var n=this;this.validPoints=!1,ARWasm().then((function(e){console.log("AR WASM module loaded."),n.onWasmInit(e),t&&t()}))}return a()(e,[{key:"onWasmInit",value:function(e){this._Module=e,this._init=this._Module.cwrap("_Z6initARPhmm","number",["number","number","number"]),this._resetTracking=this._Module.cwrap("_Z13resetTrackingPhmm","number",["number","number","number"]),this._track=this._Module.cwrap("_Z5trackPhmm","number",["number","number","number"])}},{key:"createImBuf",value:function(e){var t=this._Module._malloc(e.length);return this._Module.HEAPU8.set(e,t),t}},{key:"init",value:function(e,t,n){var i=this.createImBuf(e);this._init(i,t,n),this._Module._free(i)}},{key:"validHomography",value:function(e){var t=e[0]*e[4]-e[1]*e[3];return.1<Math.abs(t)&&Math.abs(t)<10}},{key:"parseResult",value:function(e){for(var t=e/Float64Array.BYTES_PER_ELEMENT,n=0,i=[];n<9;n++)i.push(this._Module.HEAPF64[t+n]);for(var o=[];n<17;n++)o.push(this._Module.HEAPF64[t+n]);return{valid:this.validHomography(i),H:i,corners:o}}},{key:"resetTracking",value:function(e,t,n){var i=this.createImBuf(e),o=this._resetTracking(i,t,n);this._Module._free(i);var r=this.parseResult(o);return this.validPoints=r.valid,r}},{key:"track",value:function(e,t,n){if(!this.validPoints)return this.resetTracking(e,t,n);var i=this.createImBuf(e),o=this._track(i,t,n);this._Module._free(i);var r=this.parseResult(o);return this.validPoints=r.valid,r}},{key:"transformElem",value:function(e,t){var n=[e[0],e[3],0,e[6],e[1],e[4],0,e[7],0,0,1,0,e[2],e[5],0,e[8]];n="matrix3d("+n.join(",")+")",t.style["-ms-transform"]=n,t.style["-webkit-transform"]=n,t.style["-moz-transform"]=n,t.style["-o-transform"]=n,t.style.transform=n,t.style.display="block"}}]),e}(),l=window.innerWidth,s=window.innerHeight,u=0;function w(){window.shouldTrack=!window.shouldTrack,window.arElem&&(window.shouldTrack?window.arElem.style.display="block":(m(window.overlayCanv.getContext("2d")),window.arElem.style.display="none"))}function c(e){e.style.position="absolute",e.style.top=0,e.style.left=0}function m(e){window.overlayCanv&&e.clearRect(0,0,l,s)}function v(){window.stats.begin();var e,t,n=((e=window.videoCanv.getContext("2d")).drawImage(window.videoElem,0,0,l,s),e.getImageData(0,0,l,s).data);window.shouldTrack&&((t=++u%120==0?window.tracker.resetTracking(n,l,s):window.tracker.track(n,l,s)).valid?(window.tracker.transformElem(t.H,window.arElem),function(e){if(window.overlayCanv){var t=window.overlayCanv.getContext("2d");m(t),t.beginPath(),t.strokeStyle="blue",t.lineWidth=2,t.moveTo(e[0],e[1]),t.lineTo(e[2],e[3]),t.lineTo(e[4],e[5]),t.lineTo(e[6],e[7]),t.lineTo(e[0],e[1]),t.stroke()}}(t.corners)):(m(window.overlayCanv.getContext("2d")),window.arElem.style.display="none"));window.stats.end(),requestAnimationFrame(v)}window.addEventListener("touchstart",w),window.addEventListener("mousedown",w),window.onload=function(){window.tracker=new d((function(){window.stats=new Stats,window.stats.showPanel(0),document.getElementById("stats").appendChild(stats.domElement),function(e,t,n){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){window.videoElem=document.createElement("video"),window.videoElem.setAttribute("autoplay",""),window.videoElem.setAttribute("muted",""),window.videoElem.setAttribute("playsinline","");var i=window.orientation?l:s,o=window.orientation?s:l;navigator.mediaDevices.getUserMedia({audio:!1,video:{width:{ideal:i},height:{ideal:o},aspectRatio:{ideal:i/o},facingMode:"environment"}}).then((function(e){window.videoElem.srcObject=e,window.videoElem.onloadedmetadata=function(e){window.videoElem.play()}})).catch((function(e){console.warn("ERROR: "+e)})),window.videoCanv=document.createElement("canvas"),c(window.videoCanv),window.videoCanv.style.zIndex=-1,e&&(window.videoCanv.width=l,window.videoCanv.height=s,document.body.appendChild(window.videoCanv)),t&&(window.overlayCanv=document.createElement("canvas"),c(window.overlayCanv),window.overlayCanv.width=l,window.overlayCanv.height=s,window.overlayCanv.style.zIndex=0,document.body.appendChild(window.overlayCanv)),null!=n&&n()}else console.warn("Browser does not support getUserMedia!")}(!0,!0,(function(){window.tracker.init(function(){var e=document.getElementById("refIm"),t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height).data}(),refIm.width,refIm.height),window.arElem=document.getElementById("arElem"),window.arElem.style["transform-origin"]="top left",window.arElem.style.zIndex=1;document.getElementById("instructions");instructions.className="show",setTimeout((function(){instructions.className="hide"}),5e3),requestAnimationFrame(v)}))}))}}]).default;