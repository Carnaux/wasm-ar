{"version":3,"sources":["webpack://WasmAR/webpack/bootstrap","webpack://WasmAR/./html/grayscale.js","webpack://WasmAR/./html/imageTracker.js","webpack://WasmAR/./html/index.js","webpack://WasmAR/./html/shaders/flip-image.glsl","webpack://WasmAR/./html/shaders/grayscale.glsl","webpack://WasmAR/./node_modules/@babel/runtime/helpers/classCallCheck.js","webpack://WasmAR/./node_modules/@babel/runtime/helpers/createClass.js","webpack://WasmAR/./node_modules/@babel/runtime/helpers/typeof.js"],"names":["GrayScale","source","width","height","canvas","_source","_sourceType","_width","_height","_canvas","document","createElement","_flipImageProg","require","_grayscaleProg","glReady","initGL","vertShaderSource","fragShaderSource","gl","getContext","viewport","drawingBufferWidth","drawingBufferHeight","clearColor","clear","COLOR_BUFFER_BIT","vertShader","createShader","VERTEX_SHADER","fragShader","FRAGMENT_SHADER","shaderSource","compileShader","program","createProgram","attachShader","linkProgram","useProgram","vertices","Float32Array","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","positionLocation","getAttribLocation","vertexAttribPointer","FLOAT","enableVertexAttribArray","texture","createTexture","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","pixelBuf","Uint8Array","grayBuf","undefined","texImage2D","RGBA","UNSIGNED_BYTE","drawArrays","TRIANGLES","readPixels","j","i","length","Promise","resolve","reject","navigator","mediaDevices","getUserMedia","window","orientation","Math","max","min","audio","video","ideal","aspectRatio","facingMode","frameRate","then","stream","srcObject","onloadedmetadata","e","play","err","console","warn","N","ImageTracker","callback","_this","validPoints","ARWasm","Module","log","onWasmInit","_Module","_init","cwrap","_resetTracking","_track","imPtr","_malloc","refImArr","refImWidth","refImHeight","refImPtr","HEAPU8","set","h","det","abs","ptr","ptrF64","Float64Array","BYTES_PER_ELEMENT","push","HEAPF64","warped","valid","validHomography","H","corners","imArr","res","resObj","parseResult","resetTracking","elem","transform","join","style","display","innerWidth","innerHeight","shouldTrack","arElem","refIm","frames","stats","grayscale","tracker","overlayCanv","initStats","Stats","showPanel","getElementById","appendChild","domElement","toggleTracking","clearOverlayCtx","addEventListener","setVideoStyle","position","top","left","setupVideo","setupCallback","setAttribute","zIndex","body","requestStream","id","overlayCtx","clearRect","drawCorners","beginPath","strokeStyle","lineWidth","moveTo","lineTo","stroke","processVideo","begin","frame","getFrame","track","transformElem","end","requestAnimationFrame","createRefIm","refGrayscale","onload","init","instructionsPopUp","instructions","className","setTimeout"],"mappings":"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","file":"wasm-ar.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./html/index.js\");\n","export class GrayScale\n{\n    constructor(source, width, height, canvas) {\n        this._source = source;\n        this._sourceType = typeof this._source;\n        this._width = width;\n        this._height = height;\n        this._canvas = canvas ? canvas : document.createElement(\"canvas\");\n        this._canvas.width = width;\n        this._canvas.height = height;\n\n        this._flipImageProg = require(\"./shaders/flip-image.glsl\");\n        this._grayscaleProg = require(\"./shaders/grayscale.glsl\");\n        this.glReady = false;\n        this.initGL(this._flipImageProg, this._grayscaleProg);\n    }\n\n    initGL(vertShaderSource, fragShaderSource) {\n        this.gl = this._canvas.getContext(\"webgl\");\n\n        this.gl.viewport(0, 0, this.gl.drawingBufferWidth, this.gl.drawingBufferHeight);\n        this.gl.clearColor(0.1, 0.1, 0.1, 1.0);\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n\n        const vertShader = this.gl.createShader(this.gl.VERTEX_SHADER);\n        const fragShader = this.gl.createShader(this.gl.FRAGMENT_SHADER);\n\n        this.gl.shaderSource(vertShader, vertShaderSource);\n        this.gl.shaderSource(fragShader, fragShaderSource);\n\n        this.gl.compileShader(vertShader);\n        this.gl.compileShader(fragShader);\n\n        const program = this.gl.createProgram();\n        this.gl.attachShader(program, vertShader);\n        this.gl.attachShader(program, fragShader);\n\n        this.gl.linkProgram(program);\n\n        this.gl.useProgram(program);\n\n        const vertices = new Float32Array([\n            -1, -1,\n            -1,  1,\n             1,  1,\n            -1, -1,\n             1,  1,\n             1, -1,\n        ]);\n\n        const buffer = this.gl.createBuffer();\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, buffer);\n        this.gl.bufferData(this.gl.ARRAY_BUFFER, vertices, this.gl.STATIC_DRAW);\n\n        const positionLocation = this.gl.getAttribLocation(program, \"position\");\n\n        this.gl.vertexAttribPointer(positionLocation, 2, this.gl.FLOAT, false, 0, 0);\n        this.gl.enableVertexAttribArray(positionLocation);\n\n        const texture = this.gl.createTexture();\n        this.gl.activeTexture(this.gl.TEXTURE0);\n        this.gl.bindTexture(this.gl.TEXTURE_2D, texture);\n\n        // if either dimension of image is not a power of 2\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);\n\n        this.glReady = true;\n        this.pixelBuf = new Uint8Array(this.gl.drawingBufferWidth * this.gl.drawingBufferHeight * 4);\n        this.grayBuf = new Uint8Array(this.gl.drawingBufferWidth * this.gl.drawingBufferHeight);\n    }\n\n    getFrame() {\n        if (!this.glReady) return undefined;\n\n        this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this._source);\n        this.gl.drawArrays(this.gl.TRIANGLES, 0, 6);\n\n        this.gl.readPixels(0, 0, this.gl.drawingBufferWidth, this.gl.drawingBufferHeight, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this.pixelBuf);\n\n        let j = 0;\n        for (let i = 0; i < this.pixelBuf.length; i += 4) {\n            this.grayBuf[j] = this.pixelBuf[i];\n            j++;\n        }\n\n        return this.grayBuf;\n    }\n\n    requestStream() {\n        return new Promise((resolve, reject) => {\n            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia)\n                return reject();\n\n            let width = this._width;\n            let height = this._height;\n            // check for mobile orientation\n            if (window.orientation) {\n                if (window.orientation == 90 || window.orientation == -90) {\n                    width  = Math.max(width, height);\n                    height = Math.min(width, height);\n                }\n                else {\n                    width  = Math.min(width, height);\n                    height = Math.max(width, height);\n                }\n            }\n\n            navigator.mediaDevices.getUserMedia({\n                audio: false,\n                video: {\n                    width: { ideal: height },\n                    height: { ideal: width },\n                    aspectRatio: { ideal: height / width },\n                    facingMode: \"environment\",\n                    frameRate: 30,\n                }\n            })\n            .then(stream => {\n                this._source.srcObject = stream;\n                this._source.onloadedmetadata = e => {\n                    this._source.play();\n                    resolve(this._source, stream);\n                };\n            })\n            .catch(err => {\n                console.warn(\"ERROR: \" + err);\n            });\n        });\n    }\n}\n","const N = 10;\n\nexport class ImageTracker {\n    constructor(width, height, callback) {\n        let _this = this;\n\n        this._width = width;\n        this._height = height;\n\n        this.validPoints = false;\n        ARWasm().then(function (Module) {\n            console.log(\"AR WASM module loaded.\");\n            _this.onWasmInit(Module);\n            if (callback) callback();\n        });\n    }\n\n    onWasmInit(Module) {\n        this._Module = Module;\n\n        this._init = this._Module.cwrap(\"_Z6initARPhmm\", \"number\", [\"number\", \"number\", \"number\"]);\n        this._resetTracking = this._Module.cwrap(\"_Z13resetTrackingPhmm\", \"number\", [\"number\", \"number\", \"number\"]);\n        this._track = this._Module.cwrap(\"_Z5trackPhmm\", \"number\", [\"number\", \"number\", \"number\"]);\n\n        this.imPtr = this._Module._malloc(this._width * this._height);\n    }\n\n    init(refImArr, refImWidth, refImHeight) {\n        this.refImPtr = this._Module._malloc(refImArr.length);\n        this._Module.HEAPU8.set(refImArr, this.refImPtr);\n        this._init(this.refImPtr, refImWidth, refImHeight);\n        // this._Module._free(this.refImPtr);\n    }\n\n    validHomography(h) {\n        const det = h[0]*h[4]-h[1]*h[3]; // check if determinant of top left 2x2 is valid\n        return (1/N < Math.abs(det) && Math.abs(det) < N);\n    }\n\n    parseResult(ptr) {\n        const ptrF64 = ptr / Float64Array.BYTES_PER_ELEMENT;\n\n        let i = 0;\n\n        const h = [];\n        for (; i < 9; i++) {\n            h.push(this._Module.HEAPF64[ptrF64+i]);\n        }\n\n        const warped = [];\n        for (; i < 17; i++) {\n            warped.push(this._Module.HEAPF64[ptrF64+i]);\n        }\n\n        return {\n            valid: this.validHomography(h),\n            H: h,\n            corners: warped\n        };\n    }\n\n    resetTracking(imArr) {\n        this._Module.HEAPU8.set(imArr, this.imPtr);\n        const res = this._resetTracking(this.imPtr, this._width, this._height);\n        // this._Module._free(this.imPtr);\n\n        const resObj = this.parseResult(res);\n        this.validPoints = resObj.valid;\n        return resObj;\n    }\n\n    track(imArr) {\n        if (!this.validPoints) {\n            return this.resetTracking(imArr, this._width, this._height);\n        }\n        this._Module.HEAPU8.set(imArr, this.imPtr);\n        const res = this._track(this.imPtr, this._width, this._height);\n        // this._Module._free(this.imPtr);\n\n        const resObj = this.parseResult(res);\n        this.validPoints = resObj.valid;\n        return resObj;\n    }\n\n    transformElem(h, elem) {\n        // column major order\n        let transform = [h[0], h[3], 0, h[6],\n                         h[1], h[4], 0, h[7],\n                          0  ,  0  , 1,  0  ,\n                         h[2], h[5], 0, h[8]];\n        transform = \"matrix3d(\"+transform.join(\",\")+\")\";\n        elem.style[\"-ms-transform\"] = transform;\n        elem.style[\"-webkit-transform\"] = transform;\n        elem.style[\"-moz-transform\"] = transform;\n        elem.style[\"-o-transform\"] = transform;\n        elem.style.transform = transform;\n        elem.style.display = \"block\";\n    }\n}\n","import { GrayScale } from \"./grayscale.js\"\nimport { ImageTracker } from \"./imageTracker.js\"\n\nlet width = window.innerWidth;\nlet height = window.innerHeight;\n\nlet shouldTrack = false;\n\nlet arElem = null;\nlet refIm = null;\n\nlet frames = 0;\nlet stats = null;\nlet grayscale = null;\nlet tracker = null;\n\nlet overlayCanv = null;\n\nfunction initStats() {\n    stats = new Stats();\n    stats.showPanel(0);\n    document.getElementById(\"stats\").appendChild(stats.domElement);\n}\n\nfunction toggleTracking() {\n    shouldTrack = !shouldTrack;\n    if (arElem) {\n        if (shouldTrack) {\n            // arElem.style.display = \"block\";\n        }\n        else {\n            clearOverlayCtx(overlayCanv.getContext(\"2d\"));\n            arElem.style.display = \"none\";\n        }\n    }\n}\nwindow.addEventListener(\"touchstart\", toggleTracking);\nwindow.addEventListener(\"mousedown\", toggleTracking);\n\nfunction setVideoStyle(elem) {\n    elem.style.position = \"absolute\";\n    elem.style.top = 0;\n    elem.style.left = 0;\n}\n\nfunction setupVideo(setupCallback) {\n    return new Promise((resolve, reject) => {\n        let video = document.createElement(\"video\");\n        video.setAttribute(\"autoplay\", \"\");\n        video.setAttribute(\"muted\", \"\");\n        video.setAttribute(\"playsinline\", \"\");\n        // document.body.appendChild(video);\n\n        let canvas = document.createElement(\"canvas\");\n        canvas.style.zIndex = -1;\n        setVideoStyle(canvas);\n        document.body.appendChild(canvas);\n\n        grayscale = new GrayScale(video, width, height, canvas);\n        grayscale.requestStream()\n            .then(() => {\n                overlayCanv = document.createElement(\"canvas\");\n                setVideoStyle(overlayCanv);\n                overlayCanv.id = \"overlay\";\n                overlayCanv.width = width;\n                overlayCanv.height = height;\n                overlayCanv.style.zIndex = 0;\n                document.body.appendChild(overlayCanv);\n                resolve();\n            })\n            .catch(err => {\n                console.warn(\"ERROR: \" + err);\n                reject();\n            });\n    });\n}\n\nfunction clearOverlayCtx(overlayCtx) {\n    if (!overlayCanv) return;\n    overlayCtx.clearRect(\n        0, 0,\n        width,\n        height\n    );\n}\n\nfunction drawCorners(corners) {\n    if (!overlayCanv) return;\n    const overlayCtx = overlayCanv.getContext(\"2d\");\n    clearOverlayCtx(overlayCtx);\n\n    overlayCtx.beginPath();\n    overlayCtx.strokeStyle = \"blue\";\n    overlayCtx.lineWidth = 2;\n\n    // [x1,y1,x2,y2...]\n    overlayCtx.moveTo(corners[0], corners[1]);\n    overlayCtx.lineTo(corners[2], corners[3]);\n    overlayCtx.lineTo(corners[4], corners[5]);\n    overlayCtx.lineTo(corners[6], corners[7]);\n    overlayCtx.lineTo(corners[0], corners[1]);\n\n    overlayCtx.stroke();\n}\n\nfunction processVideo() {\n    stats.begin();\n\n    const frame = grayscale.getFrame();\n    if (frame && shouldTrack) {\n        let res;\n        if (++frames % 60 == 0) { // reset tracking every 60 frames in case tracking gets lost\n            res = tracker.resetTracking(frame, width, height);\n        }\n        else {\n            res = tracker.track(frame, width, height);\n        }\n\n        if (res.valid) {\n            tracker.transformElem(res.H, arElem);\n            drawCorners(res.corners);\n        }\n        else {\n            clearOverlayCtx(overlayCanv.getContext(\"2d\"));\n            arElem.style.display = \"none\";\n        }\n    }\n\n    stats.end();\n\n    requestAnimationFrame(processVideo);\n}\n\nfunction createRefIm() {\n    refIm = document.getElementById(\"refIm\");\n    let refGrayscale = new GrayScale(refIm, refIm.width, refIm.height, null);\n    return refGrayscale.getFrame();\n}\n\nwindow.onload = () => {\n    tracker = new ImageTracker(width, height, () => {\n        initStats();\n        setupVideo()\n            .then(() => {\n                tracker.init(createRefIm(), refIm.width, refIm.height);\n\n                arElem = document.getElementById(\"arElem\");\n                arElem.style[\"transform-origin\"] = \"top left\"; // default is center\n                arElem.style.zIndex = 1;\n\n                const instructionsPopUp = document.getElementById(\"instructions\");\n                instructions.className = \"show\";\n                setTimeout(() => { instructions.className = \"hide\"; }, 5000);\n\n                requestAnimationFrame(processVideo);\n            });\n    });\n}\n","module.exports = \"attribute vec2 position;\\nvarying vec2 tex_coords;\\nvoid main(void) {\\ntex_coords = (position + 1.0) / 2.0;\\ntex_coords.y = 1.0 - tex_coords.y;\\ngl_Position = vec4(position, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nuniform sampler2D u_image;\\nvarying vec2 tex_coords;\\nconst vec3 g = vec3(0.299, 0.587, 0.114);\\nvoid main(void) {\\nvec4 color = texture2D(u_image, tex_coords);\\nfloat gray = dot(color.rgb, g);\\ngl_FragColor = vec4(vec3(gray), 1.0);\\n}\"","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;"],"sourceRoot":""}